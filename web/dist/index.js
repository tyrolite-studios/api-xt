(()=>{"use strict";function t(t,...e){let n=[];try{throw Error("foo")}catch(t){n=t.stack.split("\n")}const o=[];let r=0;for(const t of n){const e=r;if(r++,e<=1)continue;if(2===e){o.push(t.trim());continue}if(e>6)break;const[n]=t.split("(");o.push(n.substring(6).trim())}return console.group("Debug "+o.join(" <- ")),console.log(t,...e),console.groupEnd(),t}const e=t=>null===t;function n(t){return"string"==typeof t}function o(t){return Array.isArray(t)}function r(t){return!!t&&"object"==typeof t&&!o(t)}function s(t){return"function"==typeof t}function i(t){if(!t)return[];const e=/\b(full|w-full|h-full)\b/g;return t.match(e)||[]}class d{constructor(t="",e=""){this.cls=[],this.add(t),this.overwrites=e}add(t=""){t&&this.cls.push(t)}addIf(t,e,n=""){t?this.add(e):this.add(n)}addIfProps(t){for(const[e,n]of Object.entries(t))s(n)&&(n=n()),n&&this.add(e)}getDeletesAndAdds(){const t=this.overwrites.split(" "),e=[],n=[];for(const o of t)o.startsWith("not_")?e.push(o.substring(4)):n.push(o);return{adds:n,deletes:e}}get value(){const t=this.cls.join(" ");if(!this.overwrites)return t;const{adds:e,deletes:n}=this.getDeletesAndAdds(),o=undefined;return[...t.split(" ").filter((t=>!n.includes(t))),...e].join(" ")}}function a(t){return"undefined"!=typeof DOMException&&t instanceof DOMException&&("QuotaExceededError"===t.name||"NS_ERROR_DOM_QUOTA_REACHED"===t.name)}const c=(t,e="")=>{let o=!1;const r=new Set,s=e.length;for(let n=0;n<t.length;n++){const o=t.key(n);o.startsWith(e)&&r.add(o.substring(s))}const i={get:(n,o)=>{const r=t.getItem(e+n);return null===r?o:r},getJson:(t,e)=>i.getByType("json",t,e),getByType:(t,e,n)=>{const o=i.get(e+"_"+t);if(void 0===o)return n;switch(t){case"json":return JSON.parse(o)}throw Error(`Unsupported type "${t}" for decoding given!`)},has:t=>r.has(t),hasJson:t=>i.hasByType(t,"json"),hasByType:(t,e)=>i.has(t+"_"+e),set:(s,i)=>{if(!n(i))throw Error(`Expected value for id "${s}" to be a string but got ${typeof i}`);try{t.setItem(e+s,i)}catch(t){return a(t)&&(o=!0),!1}return r.add(s),!0},setJson:(t,e)=>i.setByType("json",t,e),setByType:(t,e,n)=>{if(void 0===n)throw Error(`Cannot store undefined value for id "${e}"`);const o=i.encode(t,n);return i.set(e+"_"+t,o)},delete:n=>!!r.has(n)&&(t.removeItem(e+n),r.delete(n),o=!1,!0),deleteJson:t=>i.deleteByType("json",t),deleteByType:(t,e)=>i.delete(e+"_"+t),keys:()=>[...r],isAvailable:()=>{try{const e="__storage_test__";return t.setItem(e,"1"),t.removeItem(e),!0}catch(e){return"undefined"!=typeof DOMException&&e instanceof DOMException&&!a(e)&&(22===e.code||1014===e.code)&&t&&0!==t.length}},isFull:()=>o,size:()=>r.size,encode:(t,e)=>{switch(t){case"json":return JSON.stringify(e)}throw Error(`Unsupported type "${t}" for encoding given!`)}};return i},l={};let u=null,g=null,p=null,f=null,m=null,h=!0,b=null;const w={getStorages:()=>{if(!u){if(null===b)throw Error("No store prefix was set");const t=`${b}${f}.`;u={local:c(localStorage,t),session:c(sessionStorage,t)}}return u},clearJwtCookie(){document.cookie=`${m}=; Max-Age=-9999; path=/`},clearJwt(){w.tokenStorage.delete("jwt"),w.clearJwtCookie()},setJwt(t){w.tokenStorage.set("jwt",t),document.cookie=`${m}=${t}; path=/`},getStoredJwt:()=>w.tokenStorage.get("jwt"),set apiId(t){f=t},set permanent(t){h=t},set storePrefix(t){b=t},set jwtCookieKey(t){m=t},get fixJwt(){return p},set fixJwt(t){p=t},get localStorage(){return w.getStorages().local},get sessionStorage(){return w.getStorages().session},get tokenStorage(){return w[h?"localStorage":"sessionStorage"]},registerApp:(t,e,n)=>{l[t]={create:e,destroy:n}},setAppOverwrites:(t,e)=>{w.hasApp(t,!0),l[t].overwrites=e},hasApp:(t,e=!1)=>{const n=!!l[t];if(e&&!n)throw Error(`App with id "${t}" was not registered`);return n},startApp:(t,e={})=>{const n=l[t];if(!n)throw Error(`Invalid app id "${t}" given!`);const{create:o,overwrites:r={}}=n;if(g){const{destroy:t}=l[g];t&&t()}requestAnimationFrame((()=>{g=t;const n=()=>{o({...e,...r})};"loading"===document.readyState?addEventListener("DOMContentLoaded",n,{once:!0}):n()}))}};window.controller=w;const v=w,y=new URL(window.location.href);y.search="";const x=y.toString();let E=null;const k=()=>E().catch((t=>{console.error(t),S(),document.getElementById("error-info").innerText=t.message,document.getElementById("retry-btn").focus()})),A=t=>{E=t,k()},S=()=>{const t=undefined;document.getElementById("overlay").classList.toggle("hidden",!1)},I=()=>{const t=undefined;document.getElementById("overlay").classList.toggle("hidden",!0)};function J(t){v.apiId=t.apiId,v.permanent=t.permanent,v.storePrefix=t.storePrefix,v.jwtCookieKey=t.jwtCookieKey;const e=t=>{if(v.hasApp("apixt"))v.startApp("apixt",t);else{const t=document.createElement("script");t.src=`${x}/index.js`,document.head.appendChild(t)}},n=()=>{v.setJwt(v.fixJwt),e({})},o=()=>{const t=v.tokenStorage.get("lastUsername"),o=document.getElementById("username");t&&(o.value=t),o.value&&document.getElementById("password").focus();const r=v.getStoredJwt();if(v.fixJwt)return r===v.fixJwt?n():v.clearJwt(),void 0;r&&!v.hasApp("apixt")&&A((()=>fetch(x+"/refresh",{headers:{Authorization:`Bearer ${r}`}}).then((t=>{if(401===t.status)return v.clearJwt(),void 0;if(!t.ok||200!==t.status)throw Error(`Could not refresh token. Unexpected response code ${t.status} (${t.statusText})`);return t.json()})).then((t=>{if(!t)return;const{jwt:n,config:o}=t;v.setJwt(n),e(o)}))))},r=function(t){t.preventDefault();const o=new FormData(document.getElementById("login-form")),r=new URLSearchParams(o),s=o.get("username");if(s&&v.tokenStorage.set("lastUsername",s),v.fixJwt)return n(),void 0;A((()=>fetch(x,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:r}).then((t=>{if(401===t.status){const t=document.getElementById("login-form").classList;t.toggle("shake-anim",!0);const e=document.getElementsByTagName("input");for(const t of e)t.setAttribute("maxlength","0");return setTimeout((()=>{t.remove("shake-anim");for(const t of e)t.removeAttribute("maxlength");document.getElementById("password").focus()}),500),void 0}if(!t.ok)throw Error(`Could not login. Unexpected response code ${t.status} (${t.statusText})`);return t.json()})).then((t=>{if(!t)return;const{config:n,jwt:o}=t;v.setJwt(o),e(n)}))))};document.body.innerHTML='<div class="full bg-app-bg text-app-text"><div id="overlay" class="hidden full bg-overlay-bg/50 absolute"><div class="grid place-items-center h-full w-full"><div class="text-center bg-warning-bg text-warning-text w-full py-3"><div class="stack-v gap-3"><div class="text-warning-text/50">An error occured:</div><div id="error-info"></div><div class="stack-h gap-2 place-content-center"><button id="retry-btn" class="bg-button-bg text-button-text border-button-border border px-2">Retry</button><button id="cancel-btn" class="bg-button-bg text-button-text border-button-border border px-2">Cancel</button></div></div></div ></div></div><div class="grid place-content-center h-full"><form id="login-form" class="text-center"><div id="login-div" class="stack-v gap-2 border-header-border border shadow-md"><div class="bg-header-bg text-header-text px-2">Login</div><div class="grid gap-1 py-1 grid-cols-[min-content_auto] p-3"><div class="text-xs">Username:</div><input id="username" name="username" type="text" autocomplete="username" required class="invalid:bg-warning-bg invalid:text-warning-text px-2 bg-input-bg text-input-text border-input-border" /><div class="text-xs">Password:</div><input id="password" type="password" name="password" autocomplete="current-password" required class="invalid:bg-warning-bg invalid:text-warning-text px-2 bg-input-bg text-input-text border-input-border" /></div><div class="pb-2"><button type="submit" class="bg-button-bg text-button-text border border-button-border text-xs px-2">Submit</button></div></div></div></form></div></div>',document.getElementById("login-form").addEventListener("submit",r),document.getElementById("retry-btn").addEventListener("click",(()=>{I(),k()})),document.getElementById("cancel-btn").addEventListener("click",I),requestAnimationFrame((()=>o()))}v.registerApp("login",J)})();